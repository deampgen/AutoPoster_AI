import time
import telebot
from g4f.client import Client
from telebot import types
import threading

TOKEN = '8159158570:AAESvhDiR41KIxqV69WzYnWkgUIL7AU0eyY'
CHANNEL_ID = '@RandomNews22'

bot = telebot.TeleBot(TOKEN)
client = Client()

# –§–ª–∞–≥ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —Ä–∞–±–æ—Ç—ã –∞–≤—Ç–æ–ø–æ—Å—Ç–∏–Ω–≥–∞
auto_posting_active = False
post_interval = 60
last_post_time = 0


def generate_random_post():
    prompt = (
        """–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –æ–¥–∏–Ω —É–Ω–∏–∫–∞–ª—å–Ω—ã–π, –Ω–µ–æ–±—ã—á–Ω—ã–π –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Ä–∞–Ω–¥–æ–º–Ω—ã–π —Ñ–∞–∫—Ç –Ω–∞ –ª—é–±—É—é —Ç–µ–º—É: –Ω–∞—É–∫–∞, –ø—Ä–∏—Ä–æ–¥–∞, –∏—Å—Ç–æ—Ä–∏—è, –∫—É–ª—å—Ç—É—Ä–∞, –∫–æ—Å–º–æ—Å –∏–ª–∏ –≤—ã–º—ã—Å–µ–ª. –§–∞–∫—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å:
    - –ù–µ–æ—á–µ–≤–∏–¥–Ω—ã–º
    - –ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º –∏ —É–¥–∏–≤–ª—è—é—â–∏–º
    - –ö—Ä–∞—Ç–∫–∏–º (1‚Äì3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
    - –ú–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–∞—É—á–Ω—É—é –∑–∞–≥–∞–¥–∫—É, –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫—É—Ä—å—ë–∑, —Å—Ç—Ä–∞–Ω–Ω—ã–π –∑–∞–∫–æ–Ω –ø—Ä–∏—Ä–æ–¥—ã –∏–ª–∏ —Ñ—É—Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫—É—é —Ç–µ–æ—Ä–∏—é

    –ü—Ä–∏–º–µ—Ä—ã:
    üîπ –í 1958 –≥–æ–¥—É NASA –æ—Ç–ø—Ä–∞–≤–∏–ª–æ –≤ –∫–æ—Å–º–æ—Å –∑–æ–ª–æ—Ç—É—é –º—ã—à—å.
    üîπ –£ –æ—Å—å–º–∏–Ω–æ–≥–∞ —Ç—Ä–∏ —Å–µ—Ä–¥—Ü–∞ –∏ —Å–∏–Ω—è—è –∫—Ä–æ–≤—å.
    üîπ –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –≤–∏–¥—ã –º–µ–¥—É–∑ –º–æ–≥—É—Ç "—Å—Ç–∞—Ä–µ—Ç—å –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ".

    –ü—Ä–∏–¥—É–º–∞–π —Å–≤–æ–π!
"""
    )
    try:
        response = client.chat.completions.create(
            model="gpt-4o-mini",
            messages=[{"role": "user", "content": prompt}],
            web_search=False
        )
        return response.choices[0].message.content
    except Exception as e:
        return f"–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: {e}"


def post_to_channel():
    if not CHANNEL_ID:
        return
    post = generate_random_post()
    try:
        bot.send_message(CHANNEL_ID, post)
    except Exception as e:
        print(f"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ø–æ—Å—Ç: {e}")


def auto_post_loop():
    global auto_posting_active
    while auto_posting_active:
        post_to_channel()
        time.sleep(post_interval)


@bot.message_handler(commands=['start'])
def start(message):
    bot.reply_to(message, "–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /run –¥–ª—è –∞–≤—Ç–æ–ø—É–±–ª–∏–∫–∞—Ü–∏–∏.")


@bot.message_handler(commands=['channel'])
def send_post_now(message):
    post = generate_random_post()
    bot.send_message(message.chat.id, post)
    if CHANNEL_ID:
        bot.send_message(CHANNEL_ID, post)


@bot.message_handler(commands=['run'])
def run(message):
    global auto_posting_active
    if auto_posting_active:
        bot.reply_to(message, "–ê–≤—Ç–æ–ø—É–±–ª–∏–∫–∞—Ü–∏—è —É–∂–µ –∑–∞–ø—É—â–µ–Ω–∞.")
        return

    auto_posting_active = True
    bot.reply_to(message, "–ê–≤—Ç–æ–ø—É–±–ª–∏–∫–∞—Ü–∏—è –Ω–∞—á–∞—Ç–∞.")
    thread = threading.Thread(target=auto_post_loop)
    thread.start()


# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω...")
bot.polling(none_stop=True)
